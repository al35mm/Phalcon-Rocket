<div id="doctop"></div>
# Documentation

***
### Features:
* Bootstrap file
* Config file
* [CLI](#cli) and Console file
* HMVC support
* <a href="http://docs.phalconphp.com/en/latest/reference/volt.html" target="_blank">Volt</a>, Markdown templates
* Frontend/Backend/Cli/Documentation modules
* Environment
 * _development_ - display debug, always compile template files, always minify assets
 * _testing_ - log debug, only checks for changes in the children templates, checks for changes and minify assets
 * _staging_ - log debug, notify admin, only checks for changes in the children templates, checks for changes and minify assets
 * _production_ - log debug, notify admin, don't check for differences, don't create missing files, compiled and minified files must exist before!
* Library
 * [Arr](#arr)
 * [Auth](#auth)
 * [Email](#email)
 * [I18n](#I18n)
 * Markdown - this documentation is written in Markdown, saved to a .md view file, and compiled by Volt!
 * [Tool](#tool)
 * [Recaptcha](#recaptcha)
* User
 * Models
 * Auth schema mysql
 * Brute force login protection - Throttles server responses on failed attempts, then uses recaptcha (if enabled in config) then blocks the login form for 10 mins. (does not use cookies)
 * Resend confirmation email - with change email address option
 * Password reset (forgot password)
* Semantic UI

***

### Requirements:
* Phalcon 2.x+
* PHP >= 5.5.x
* MySQL

***

### Links:
* [Phalcon PHP](https://phalconphp.com)
* [Phalcon Rocket on GitHub](https://github.com/al35mm/Phalcon-Rocket-App)
* [Semantic UI](http://http://semantic-ui.com/)

***

### Configuration:
There are 3 config files *config.ini, development.ini & production.ini*. *config.ini* contains general settings, 
while *development.ini & production.ini* contain settings that will vary according to the mode of operation, 
in particular paths, URIs, databases etc.
1. Use the bundled*.sql* to create required database tables
2. Set *base_uri* and other settings in the config files located at `/app/common/config/`
(the `router.php` file is also located in the config directory)

```ini
[app]
domain = "example.com"
base_uri = "/"
static_uri = "/"
admin = "admin@example.com"
```
<br />
Enter the settings to connect to the database:
```ini
[database]
host     = "localhost"
username = "baseapp"
password = "password"
dbname   = "baseapp"
```
<br />
Change the default hash keys. It is **very important** for security reasons:
```ini
[auth]
hash_key = "secret_key"

[crypt]
key = "secret_key"
```
<br />
You may need to prepare the application for the first run:
```bash
# go to /path/base-app/private
php index.php prepare chmod
```
***


### Example volt usage:
Access to `auth` in the views:
```django
{% if auth.logged_in() %}
    {{ auth.get_user().username }}
{% endif %}
```
<br />
Easy translation with `__()` function:
```django
{% if auth.logged_in('admin') %}
    {{ __('Hello :user', [':user' : auth.get_user().username]) }}
{% endif %}
```
<br />
Use static classes:
```django
{# access to some model #}
{% set user = users__findFirst(1) %}
{{ user.username }}

{# access to class in the library #}
{{ arr__get(_POST, 'username') }}
```
<br />
Debug variables:
```php
{{ dump('string', 1, 2.5, TRUE, NULL, ['key': 'value']) }}
```
<br><br><br>
***
### Specific Details
***
<div id="cli"></div>
##CLI
CLI is run from the "private" directory
```
cd /path/base-app/private
php index.php task action
```
<br>
Big tasks that may run into execution time limits can be run using the Each.sh script instead
```
cd /path/base-app/private
sh Each.sh task/action task2/action2
```
<br>
First task/action should return IDS eg. 1 5 7 13, generated by
```
echo implode(' ', array(1, 5, 7, 13));
```
If count IDS > 0 script for each IDS will launch a TASK2 ACTION2 ID. You can also debug output from task2/action2 by specify third param:
```
sh Each.sh task/action task2/action2 debug
```
<a href="#doctop" style="float:right;"><i class="arrow up icon"></i> Top</a>
<br>
<div style="clear: left;"></div>
***
<div id="arr"></div>
##Arr
####Example usage
#####callback( string $str )
```
<?php
use Baseapp\Library\Arr;

// Get the callback function and parameters
list($func, $params) = Arr::callback('Foo::bar(apple,orange)');

// Get the result of the callback
$result = call_user_func_array($func, $params);
```
<br>
#####extract( array $array , array $paths [, mixed $default = NULL ] )
```
<?php
// Get the values "username", "password" from $_POST
$auth = Arr::extract($_POST, array('username', 'password'));

// Get the value "level1.level2a" from $data
$data = array('level1' => array('level2a' => 'value 1', 'level2b' => 'value 2'));
Arr::extract($data, array('level1.level2a', 'password'));
```
<br>
#####flatten( array $array )
```
<?php

$array = array('set' => array('one' => 'something'), 'two' => 'other');

// Flatten the array
$array = Arr::flatten($array);

// The array will now be
array('one' => 'something', 'two' => 'other');
```
<br>
#####get( array $array , string $key [, mixed $default = NULL ] )
```
<?php
// Get the value "username" from $_POST, if it exists
$username = Arr::get($_POST, 'username');

// Get the value "sorting" from $_GET, if it exists
$sorting = Arr::get($_GET, 'sorting');
```
<br>
#####is_array( mixed $value )
```
<?php
// Returns TRUE
Arr::is_array(array());
Arr::is_array(new ArrayObject);

// Returns FALSE
Arr::is_array(FALSE);
Arr::is_array('not an array!');
```
<br>
#####is_assoc( array $array )
```
<?php
// Returns TRUE
Arr::is_assoc(array('username' => 'john.doe'));

// Returns FALSE
Arr::is_assoc('foo', 'bar');
```
<br>
#####map( mixed $callbacks , array $array [, array $keys = NULL ] )
```
<?php
// Apply "strip_tags" to every element in the array
$array = Arr::map('strip_tags', $array);

// Apply $this->filter to every element in the array
$array = Arr::map(array(array($this,'filter')), $array);

// Apply strip_tags and $this->filter to every element
$array = Arr::map(array('strip_tags',array($this,'filter')), $array);
```
<br>
#####merge( array $array1 , array $array2 )
```
<?php
$john = array('name' => 'john', 'children' => array('fred', 'paul', 'sally', 'jane'));
$mary = array('name' => 'mary', 'children' => array('jane'));

// John and Mary are married, merge them together
$john = Arr::merge($john, $mary);

// The output of $john will now be:
array('name' => 'mary', 'children' => array('fred', 'paul', 'sally', 'jane'))
```
<br>
#####overwrite( array $array1 , array $array2 )
```
<?php
$a1 = array('name' => 'john', 'mood' => 'happy', 'food' => 'bacon');
$a2 = array('name' => 'jack', 'food' => 'tacos', 'drink' => 'beer');

// Overwrite the values of $a1 with $a2
$array = Arr::overwrite($a1, $a2);

// The output of $array will now be:
array('name' => 'jack', 'mood' => 'happy', 'food' => 'tacos')
```
<br>
#####path( array $array , mixed $path [, mixed $default = NULL , string $delimiter = NULL ] )
```
<?php
// Get the value of $array['foo']['bar']
$value = Arr::path($array, 'foo.bar');


// Get the values of "color" in theme
$colors = Arr::path($array, 'theme.*.color');

// Using an array of keys
$colors = Arr::path($array, array('theme', '*', 'color'));
```
<br>
#####pluck( array $array , string $key )
```
<?php
// Get all of the "id" values from a result
$ids = Arr::pluck($result, 'id');
```
<br>
#####range( [ integer $step = integer 10 , integer $max = integer 100 ] )
```
<?php
// Fill an array with values 5, 10, 15, 20
$values = Arr::range(5, 20);
```
<br>
#####set_path( array & $array , string $path , mixed $value [, string $delimiter = NULL ] )
```
<?php
// Set a value on an array by path.
```
<br>
#####unshift( array & $array , string $key , mixed $val ) (defined in Kohana_Arr)
```
<?php
// Add an empty value to the start of a select list
Arr::unshift($array, 'none', 'Select a value');
```
<a href="#doctop" style="float:right;"><i class="arrow up icon"></i> Top</a>
<div style="clear: left;"></div>
<br>
<div id="auth"></div>
***
##Auth
###Example usage
#####Log in
```
<?php
use Baseapp\Library\Auth;

if ($this->request->getPost('username') && $this->request->getPost('password'))
{
    $login = Auth::instance()->login($this->request->getPost('username'), $this->request->getPost('password'), $this->request->getPost('remember') ? TRUE : FALSE);
    if ( ! $login)
    {
        // Login failed, send back to form with error message
    }
    else
    {
        // Login successful
    }
}
```
<br>
#####Logged in user
```
<?php
if (Auth::instance()->logged_in())
{
    // User is logged in, continue on
}
else
{
    // User isn't logged in, redirect to the login form.
}
```
```
<?php
$user = Auth::instance()->get_user();
// Check for a user (NULL if not user is found)
if ($user !== null)
{
     // User is found, continue on
     $username = $user->username;
}
else
{
    // User was not found, redirect to the login form
}
```
```
<?php
if (Auth::instance()->logged_in("admin"))
{
    // Admin privileges
}
else
{
    // No access
}
```
<br>
#####Log out
```
<?php
Auth::instance()->logout();
$this->response->redirect('');
```
<br>
#####In volt
```
{% if auth.logged_in() %}
    {{ auth.get_user().username }}
{% endif %}
```
```
{% if auth.logged_in('admin') %}
    {# __() is a function which translates #}
    {{ linkTo('admin', __('Admin panel')) }}
{% endif %}
```
<a href="#doctop" style="float:right;"><i class="arrow up icon"></i> Top</a>
<div style="clear: left;"></div>
<br>
<div id="email"></div>
***
##Email
###Example usage
#####Easy way to load email layout, a view from views/email/ and pass parameters to the view.
```
<?php
$email = new Email();
$email->prepare($subject, $to, $view, $params = array());
$email->Send();
```
<br>
#####You can use all <a href="https://github.com/PHPMailer/PHPMailer/" target="_blank">PHPMailer</a> features like:
```
<?php
$email->addReplyTo('info@example.com', 'Information');
$email->addBCC('bcc@example.com');
```
<a href="#doctop" style="float:right;"><i class="arrow up icon"></i> Top</a>
<div style="clear: left;"></div>
<br>
<div id="I18n"></div>
***
##I18n
###Example usage
#####Easy translation, just place messages at __() function and after changing language the strings will be automatically translated to eg. PL lang from common/i18n/pl.php file.
```
<?php
echo __('The base application in PhalconPHP');
echo __('Hello :user', array(':user' => 'mruz'));
```
<br>
#####Also available in volt
```
{{ __('Hello :user', [':user' : 'mruz']) }}
```
<a href="#doctop" style="float:right;"><i class="arrow up icon"></i> Top</a>
<div style="clear: left;"></div>
<br>
<div id="tool"></div>
***
##Tool
###Example usage
#####label($str, $space = ' ') Replace CamelCase and Underscores to spaces
You can use this function for generate labels from input's name, eg. replace repeatPassword to Repeat password:
```
<?php $field = 'repeatPassword';?>
<label for=<?php echo $field?>><?php echo __(Tool::label($label))?>:</label>
```
<br>
#####Also available in volt
```
{% set field = 'repeatPassword' %}
<label for={{ field }}>{{ __(field|label) }}:</label>
```
<br>
#####pagination($url, $page, $hook = '', $class = 'pagination', $count_out = 3, $count_in = 5) Prepare HTML pagination
```
First Previous 1 2 3 ... 22 23 24 25 26 [27] 28 29 30 31 32 ... 48 49 50 Next Last
```
<a href="#doctop" style="float:right;"><i class="arrow up icon"></i> Top</a>
<br>
<div style="clear: left;"></div>
***
<div id="recaptcha"></div>
##Recaptcha
Recaptcha is already integrated into the contact and sign up forms, and the sign in brute force protection system. 
There are some settings in *development.ini* and *production.ini* config files for Recaptcha integration. You 
can disable Recaptcha if you don't wish to use it simply by setting `enabled = "0"`. In order to use Recaptcha 
you must first add your private and public API keys (which you can get from 
<a href="https://www.google.com/recaptcha/intro/index.html" target="_blank">the Recaptcha site</a>) to the 
config files. There is also a Recaptcha theme setting in the config files which you can set to either light or dark 
to change the appearance of Recaptcha in your forms.

If you want to use Recaptcha with any other forms you create, it is ridiculously simple to do so! Just add the 
function to your .volt file like `{{ recaptcha() }}` and the validation to your controller like 
`$validation->add('g-recaptcha-response', new \Baseapp\Extension\Recaptcha());` as per the examples below.
###Example usage

#####Protecting a form with Recaptcha
In the form ellement of your .volt view file (formatted for Semantic UI)
```django
{# Recaptcha #}
{% if this.config.recaptcha.enabled == '1' %}
    {% set field = 'g-recaptcha-response' %}
    <div class="field{{ errors is defined and errors.filter(field) ? ' error' : '' }}">
        <label>Security</label>
        {{ recaptcha() }}
        {% if errors is defined and errors.filter(field) %}
            <span class="ui red pointing above label">{{ current(errors.filter(field)).getMessage() }}</span>
        {% endif %}
    </div>
{% endif %}
```
<br>
In the controller
```
if($this->request->isPost()){
    $validation = new \Baseapp\Extension\Validation();
    /*....Other validations go here */
    // Recaptcha validation
    if ($this->config->recaptcha->enabled == '1') {
        $validation->add('g-recaptcha-response', new \Baseapp\Extension\Recaptcha());
    }
    $messages = $validation->validate($_POST);
    if(count($messages)){
        // Oops there are errors
        $errors = $validation->getMessages();
        $this->view->setVar('errors', $errors);
    }else{
        // Validation passed
        /*.... process the form */
    }
}
```
<a href="#doctop" style="float:right;"><i class="arrow up icon"></i> Top</a>
<br>
<div style="clear: left;"></div>
